import{_ as s,c as a,o as l,ag as n}from"./chunks/framework.DPDPlp3K.js";const g=JSON.parse('{"title":"直接发送模式配置指南","description":"","frontmatter":{},"headers":[],"relativePath":"guides/direct-delivery.md","filePath":"guides/direct-delivery.md","lastUpdated":1742625674000}'),t={name:"guides/direct-delivery.md"};function e(p,i,h,k,o,r){return l(),a("div",null,i[0]||(i[0]=[n(`<h1 id="直接发送模式配置指南" tabindex="-1">直接发送模式配置指南 <a class="header-anchor" href="#直接发送模式配置指南" aria-label="Permalink to &quot;直接发送模式配置指南&quot;">​</a></h1><p>Go Mail Server 支持直接发送模式，允许系统直接将邮件发送到收件人的邮件服务器，而无需经过中间的SMTP服务器。这种模式可以提高送达率，减少依赖，并可能降低邮件被标记为垃圾邮件的几率。</p><h2 id="配置直接发送模式" tabindex="-1">配置直接发送模式 <a class="header-anchor" href="#配置直接发送模式" aria-label="Permalink to &quot;配置直接发送模式&quot;">​</a></h2><p>在 <code>config.json</code> 中添加或修改以下配置：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...其他配置项...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;directDelivery&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 启用直接发送模式</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;ehloDomain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 用于EHLO命令的域名，通常是您的域名</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;insecureSkipVerify&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 是否跳过TLS验证（生产环境建议设为false）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;retryCount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               // 发送失败时的重试次数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...其他配置项...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="发送流程说明" tabindex="-1">发送流程说明 <a class="header-anchor" href="#发送流程说明" aria-label="Permalink to &quot;发送流程说明&quot;">​</a></h2><p>启用直接发送模式后，邮件处理流程将按照以下顺序进行：</p><ol><li><strong>查找MX记录</strong>：系统解析收件人邮箱域名的MX记录，获取目标邮件服务器地址</li><li><strong>尝试直接连接</strong>：系统尝试连接到目标邮件服务器</li><li><strong>发送邮件</strong>：如果连接成功，直接将邮件发送到目标服务器</li><li><strong>备选方案</strong>：如果直接发送失败，系统会尝试使用配置的SMTP转发方式</li><li><strong>最终保障</strong>：如果所有发送尝试均失败，系统会将邮件保存在本地</li></ol><h2 id="直接发送的优势" tabindex="-1">直接发送的优势 <a class="header-anchor" href="#直接发送的优势" aria-label="Permalink to &quot;直接发送的优势&quot;">​</a></h2><ol><li><strong>减少依赖</strong>：不依赖第三方SMTP服务，提高系统可靠性</li><li><strong>提高送达率</strong>：直接发送可能降低被标记为垃圾邮件的几率</li><li><strong>配置简单</strong>：无需设置和维护SMTP服务器凭据</li><li><strong>成本效益</strong>：无需支付第三方SMTP服务费用</li></ol><h2 id="直接发送的注意事项" tabindex="-1">直接发送的注意事项 <a class="header-anchor" href="#直接发送的注意事项" aria-label="Permalink to &quot;直接发送的注意事项&quot;">​</a></h2><p>直接发送邮件虽然有诸多优势，但也有一些注意事项：</p><ol><li><p><strong>IP信誉至关重要</strong>：</p><ul><li>确保您的服务器IP没有被列入黑名单</li><li>稳定的服务器IP地址更有利于建立良好的发送信誉</li><li>考虑使用专用IP而非共享IP</li></ul></li><li><p><strong>DNS配置必不可少</strong>：</p><ul><li>正确配置SPF记录</li><li>配置DKIM签名（强烈推荐）</li><li>设置DMARC策略</li></ul></li><li><p><strong>发送量控制</strong>：</p><ul><li>避免短时间内发送大量邮件</li><li>使用系统内置的速率限制功能</li><li>新IP应该从小批量发送开始，逐渐增加</li></ul></li><li><p><strong>监控送达情况</strong>：</p><ul><li>定期检查发送日志</li><li>设置邮件退回通知</li><li>关注垃圾邮件报告</li></ul></li></ol><h2 id="优化直接发送" tabindex="-1">优化直接发送 <a class="header-anchor" href="#优化直接发送" aria-label="Permalink to &quot;优化直接发送&quot;">​</a></h2><p>为了获得最佳的直接发送效果，建议进行以下优化：</p><ol><li><p><strong>启用DKIM签名</strong>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dkim&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;domain&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;selector&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;privateKeyPath&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;keys/example.com/mail.private&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><strong>配置正确的EHLO域名</strong>：</p><ul><li><code>ehloDomain</code> 应设置为与您的发件人地址域名匹配的域名</li><li>确保该域名有正确的DNS记录</li></ul></li><li><p><strong>控制发送频率</strong>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;rateLimits&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;maxPerHour&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;maxPerDay&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><strong>仔细监控失败情况</strong>：</p><ul><li>定期检查 <code>emails/failed</code> 目录</li><li>分析失败原因并进行相应调整</li></ul></li></ol><h2 id="故障排查" tabindex="-1">故障排查 <a class="header-anchor" href="#故障排查" aria-label="Permalink to &quot;故障排查&quot;">​</a></h2><p>如果直接发送模式遇到问题，可以检查以下几点：</p><ol><li><p><strong>日志中的错误信息</strong>：</p><ul><li>查找与 &quot;尝试直接发送邮件&quot; 相关的日志</li><li>查看特定域名的MX记录解析是否成功</li><li>检查连接或认证错误</li></ul></li><li><p><strong>网络连接问题</strong>：</p><ul><li>确保服务器可以访问外部25端口（许多云服务提供商默认阻止）</li><li>检查防火墙设置</li><li>验证DNS服务是否正常工作</li></ul></li><li><p><strong>DNS配置验证</strong>：</p><ul><li>使用 <code>dig MX example.com</code> 验证MX记录</li><li>确认SPF记录包含您的发送服务器</li><li>验证DKIM记录格式是否正确</li></ul></li><li><p><strong>临时禁用直接发送</strong>：</p><ul><li>如果问题无法解决，可以临时禁用直接发送模式</li><li>将 <code>&quot;enabled&quot;: false</code> 设置在 <code>directDelivery</code> 配置中</li><li>系统将回退到使用配置的SMTP转发</li></ul></li></ol>`,19)]))}const E=s(t,[["render",e]]);export{g as __pageData,E as default};
